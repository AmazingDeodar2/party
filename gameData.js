// gameData.js

const GAME_DATA = {
  hintAssistant: {
    name: "鹅侦探",
    avatar: "e.png"
  },
  
  // 普通结局自动主线提示：按角色给
  mainlineHintsBySuspect: {
    doufupi: [
      "豆付皮多少还是了解一点音箱的，专业问题上他还是值得信任的。"
    ],
    douyacai: [
      "豆雅财还是比较好懂的，毕竟他自己有时候也会承认。"
    ],
    doushabao: [
      "豆莎包与灯的爱恨情仇从来没让人失望过。"
    ],
    douchi: [
      "豆池会整活的，虽然有时候也并非完全自愿。"
    ],
    douzhier: [
      "豆知儿最近忙得焦头烂鹅，可能会有些健忘？"
    ],
    doueyuan: [
      "豆蛾渊不是在背锅就是在背锅的路上。"
    ],
    doubanjiang: [
      "豆坂将有点怀念被绑起来的日子了。"
    ],
    dounai: [
      "豆乃自从见过了大世面之后对小事也变得关心了起来。"
    ],
    douniwan: [
      "我们真的见过豆倪万吗？"
    ]
  },
  
  // 助手可手动提供的支线提示（玩家点击选择）
  assistantBranchHints: {
    fff_club: {
      name: "FFF团",
      hint: "众所周知，漏勺桌里也不只有bg。"
    },
    best_partner: {
      name: "最佳拍档",
      hint: "考虑到大家的职业，这两人可能真的会写出这样的剧情，大概吧？"
    },
    dorm_headache: {
      name: "寝室长的噩梦",
      hint: "这四个凑在一起，让豆蛾渊想起了当时在寝室的日子。"
    },
        conspiracy: {
      name: "伊德海拉入侵预案",
      hint: "大家都知道你是信徒了，但在场的真的都是本人吗？"
    },
    clear_eyes: {
      name: "清澈的眼神",
      hint: "年轻就是好啊。"
    },
    mouse_line: {
      name: "不速之客",
      hint: "一只小家伙也想参加这场派对。"
    },
    fox_slip: {
      name: "狐狸会漏出马脚",
      hint: "成就名字本身就已经是提示了。"
    }
  },
    title: "派对时间！",
  
    introBase:
      "你收到一张豆家人的派对邀请函，封面写着：『今晚来参加一场绝对不会出意外的完美派对！』\n\n" +
      "你本来以为这就是一场普通的熟人局，顶多吵一点、闹一点。结果你按时到场，门一推开——完美没有，意外倒是超额完成了。",
  
    introVariants: [
      "门刚开一条缝，你就听见音响先惨叫了一声，像在替所有人提前喊冤。",
      "你第一眼还以为这是主题布景，第二眼发现他们的表情不像在演。",
      "有人正试图若无其事地把纸杯往桌子底下踢，但你已经看见了。",
      "你还没开口，屋里九个人已经非常默契地同时指向彼此。",
      "空气里有一种“刚刚所有人都说了不是我”的新鲜氛围。"
    ],
  
    rules: [
      "现场共有九起乱子，九个人都在场。",
      "你可以按任意顺序询问他们，但每个人只能问一次。",
      "每次流程固定为：选中角色 → 问话（唯一一次）→ 立即判断“是不是凶手” → 角色反应 → 锁定不能改。",
      "等九人全部问完，派对会根据你的选择走向不同结局。",
      "这里的“凶手”指对其对应事件负主要责任的人（不一定是故意的）。"
    ],
  
    sceneDescription:
      "你推门进来，现场已经乱成了一锅粥，就差一把勺子给你。\n\n" +
      "气球全贴在天花板上，门板上扎着飞镖，蛋糕桌空空如也，只剩一圈奶油痕和托盘印。\n" +
      "音响时不时怪叫一声，彩灯忽明忽暗乱闪，横幅挂反了还在那儿摇摇欲坠。\n" +
      "礼物堆里混着几包明显不该出现的样品包，纸杯塔倒了一地，桌边地面还有点湿，踩上去有点滑。\n" +
      "侧桌桌布上有一圈奇怪符号痕迹，前半圈像手画的线，后半圈却像被水慢慢晕开的，不太像同一个人一口气画完的。\n" +
      "角落里放着一个冰桶，冰块都快化没了，桶边留着一圈细细水痕，像刚有人在那儿来回挪过。\n" +
      "蛋糕桌边那点反光也有点怪，像奶油蹭过什么东西，又被人顺手抹了一下。\n" +
      "墙角有一小撮碎屑，像饼干被捏碎了，又像有什么东西啃过；踢脚线里偶尔传来极轻的“窸窣”声，像错觉。\n\n" +
      "而这九个人，彼此都熟，彼此都知道彼此多少有点不靠谱。\n" +
      "他们一致决定：让你来当临时调查员。\n" + 
      "现在，你不得不尝试找出每件事情的最大责任人了。",
  
    visibleEvents: [
      "气球全贴在天花板上",
      "门板上扎着飞镖",
      "蛋糕不见了",
      "音响不断发出怪声",
      "彩灯忽明忽暗乱闪",
      "礼物堆里混着奇怪样品包",
      "横幅挂反且快掉下来",
      "纸杯塔倒了一地",
      "桌布上有一圈奇怪符号痕迹"
    ],
  
    suspects: [
      {
        id: "doufupi",
        name: "豆付皮",
        avatar: "💻",
        eventTitle: "音响不断发出怪声",
        isCulprit: false,
        questionText:
          "你走近时，豆付皮正蹲在音响旁边，手里捏着一根线，肩膀缩着，像在跟机器冷战。\n\n" +
          "你问：“这动静是你弄出来的？”\n\n" +
          "他抬眼看你一秒，又低头继续理线：\n“不是。我过来的时候它就开始叫了。”\n\n" +
          "他用螺丝刀点了点地上的排插和灯控盒：\n“音响和灯控挤在一排，中间还被人拔插过。现在这声音像重启报错。”\n\n" +
          "他顿了一下，像是在回想什么：\n“刚才有一下挺怪，像不是从喇叭里出来的……算了，先当我听岔了。”\n\n" +
          "他把线捋顺一点，声音更低了：\n“本来想在她经过这边之前修好，至少别让音响当场发癫。结果越急越卡。”\n\n" +
          "说完他把线往旁边拨开一点：\n“你先别踩这根，踩到就真要听它唱整晚了。\n\n”"+
          "他顿了一下，像是在回想什么：\n“刚才有一下挺怪，像不是从喇叭里出来的……更像墙根那边窸窣了一下，音响刚好也在叫，听着就混了。”\n\n",
        reactions: {
          guilty:
            "豆付皮“哦”了一声，表情没什么变化，就是耳根有点热。\n“行，蹲在音响旁边的肯定最像。”\n\n" +
            "他把线往你鞋边拨开一点：\n“那你至少先别踩这个。待会儿她路过再被吓一跳，我更懒得解释。”",
          innocent:
            "豆付皮动作顿了一下，像是有点意外。\n“…你还看了排线啊。”\n\n" +
            "他把螺丝刀揣回口袋：\n“灯控那边有人动过。还有，离冰桶那块远点，地有点滑。”"
        }
      },
  
      {
        id: "douyacai",
        name: "豆雅财",
        avatar: "🧾",
        eventTitle: "气球全贴在天花板上",
        isCulprit: true,
        questionText:
          "豆雅财正仰头看着天花板上的气球，表情像老板看见店庆布置飞上房梁，还得先笑着说“没事”。\n\n" +
          "你问：“这片天花板景观，是你负责的？”\n\n" +
          "他先摆手：“不是我放上去的——”\n\n" +
          "话说到一半，他自己先心虚了，抬手指向门边和桌脚：\n“呃……下面那几个配重，确实是我挪的。”\n\n" +
          "“当时地垫翘起来，桌布也一直跑，我就顺手拿去压一下，想着一会儿再绑回去。结果现场一乱，我给忘了。”\n\n" +
          "他说到这儿有点不好意思地笑了下：\n“本来还想把场子收拾利索点，至少看起来像我有在认真办派对……现在好了，直接飞到天花板上去了。”\n\n" +
          "他叹口气，抬头看着那团气球：\n“你要说我没沾边，那也说不过去。”",
        reactions: {
          guilty:
            "豆雅财安静了两秒，点头认下。\n“行，这个我没法躲。”\n\n" +
            "他苦笑着摊手：\n“本来想压住一个角，结果把整片天花板送热闹了。”",
          innocent:
            "豆雅财连忙摆手，表情都认真了点。\n“别别别，你这就有点太照顾我了。”\n\n" +
            "他指了指天花板，苦笑一下：\n“哎，还是没做好嘛……当时她那里也是……”"
        }
      },
  
      {
        id: "doushabao",
        name: "豆莎包",
        avatar: "🎬",
        eventTitle: "彩灯忽明忽暗乱闪",
        isCulprit: true,
        questionText:
          "豆莎包抱着手臂盯着那串乱闪的彩灯，表情像在看一条本来能救回来、结果越剪越跑偏的素材。\n\n" +
          "你问：“灯是你动过的？”\n\n" +
          "她答得很痛快：\n“是，闭灯被动触发了。”\n\n" +
          "“你们原来那灯太平，像开会。我本来想开个暖场的，结果手滑开到演出测试模式了。”\n\n" +
          "她走过去按了按灯控边上的键位，又松手：\n“这模式会自己跑一遍全效果。再碰上这边供电乱，灯和音响挤一排，后面就开始各抽各的。”\n\n" +
          "她朝门边抬了抬下巴，像顺手提一句：\n“刚才豆乃还让我先别再碰灯，说门口那两支飞镖角度不对，叫我把人流先让开。她看走位比我看得快。”\n\n" +
          "她偏头看你，嘴角一挑：\n“我这条线跑偏是事实，但今晚肯定不止我一个人给场子加戏。”",
        reactions: {
          guilty:
            "豆莎包点点头，没推。\n“行，这边算我。”\n\n" +
            "她往四周看了一圈：\n“你接着问。别急着下结论，后面还有镜头。”",
          innocent:
            "豆莎包挑了下眉，像是被你的思路勾起兴趣。\n“我都承认动过灯了，你还不往我头上放？”\n\n" +
            "她笑了笑，朝门边看了一眼：\n“行。你看东西不只看谁碰过开关——豆乃刚才也是这么说的。”"
        }
      },
  
      {
        id: "douchi",
        name: "豆池",
        avatar: "🌀",
        eventTitle: "桌布/侧桌上有一圈奇怪符号痕迹",
        isCulprit: false,
        questionText:
          "豆池蹲在侧桌边看那圈痕迹，手里夹着两张小符纸，神情不像被抓包，倒像在看谁把她的笔记抄串行了。\n\n" +
          "你问：“这圈东西跟你有关系吗？”\n\n" +
          "她抬头看你，答得很干脆：\n“前半圈像我写的，后半圈不是。”\n\n" +
          "她伸手点了点桌布边角：\n“这边一直翘，杯子老往外滑，我就顺手补个稳固记号。不是诅咒，不是召唤，也和祂没关系。”\n\n" +
          "她把符纸在指间一转，语气挺平：\n“我平时用符咒多，懒得画这么长。你看这儿有盐粒、有水印，后半段晕得也不对，像是沾了什么才慢慢开掉的。”\n\n" +
          "说到这儿她凑近闻了一下，眉头轻轻一皱，又立刻松开：\n“……味道也不太像普通融水。算了，你先看你的。”",
        reactions: {
          guilty:
            "豆池抬了下眉，抱起手臂，倒没退。\n“行，怪我怪我。”\n\n" +
            "她用下巴点了点那圈痕迹：\n“不过你记着，我要真想弄点什么，不会留这种半截还晕开的东西给人看。”",
          innocent:
            "豆池点点头，像是觉得你至少没乱联想。\n“还行，你眼睛没只盯着‘奇怪’两个字。”\n\n" +
            "她把符纸塞回袖口：\n“顺嘴说一句，气球那边的配重是人挪走的。我没那闲工夫拿符去吹气球。”"
        }
      },
  
      {
        id: "douzhier",
        name: "豆知儿",
        avatar: "🛍️",
        eventTitle: "礼物堆里混着奇怪样品包",
        isCulprit: true,
        questionText:
          "豆知儿站在礼物堆旁边，已经把几包样品挑出来摆成一排，像临时开了个展示位。\n\n" +
          "你问：“派对礼物里混样品包，这也算你业务拓展？”\n\n" +
          "她先笑了一下，抬手摆摆手：\n“我带样品是真的，但我没往礼物里塞，先说这个。”\n\n" +
          "她把一包样品举起来给你看：\n“问题是包装颜色太像礼物纸了。我把它们放在旁边，后来有人挪桌子、搬东西，一乱就混进去了。”\n\n" +
          "她说话快，但条理很稳：\n“你要把这笔记在我头上，我认；你要说我故意夹带私货，那我得解释。”\n\n" +
          "她把样品翻过来给你看，封口角落有一排很浅的齿痕，像被什么试探性咬过。\n\n" +
          "她低头把样品重新分开放，嘴上还在念叨：\n“我本来还想早点收完给他回消息，他那边还在担心论文里的水稻长不好，连来不来都在纠结。结果这边先给我开了个现场版仓库盘点。”\n\n" +
          "她压低声音补一句：\n“门边和蛋糕桌那块都有人动过东西，你别只盯我这堆。”",
        reactions: {
          guilty:
            "豆知儿愣了一秒，职业微笑差点掉线。\n“行吧，你下手挺利索。”\n\n" +
            "她叹口气：\n“哈哈，都忘了，好像来搬东西的人也是我。”",
          innocent:
            "豆知儿冲你比了个“OK”。\n\n" +
            "她眨眨眼，把手机扣回口袋：\n“行，我能先给他回个消息了。你继续忙，优先看那些真挪过现场结构的人。”"
        }
      },
  
      {
        id: "doueyuan",
        name: "豆蛾渊",
        avatar: "🩺",
        eventTitle: "纸杯塔倒了一地（地面有点湿）",
        isCulprit: true,
        questionText:
          "豆蛾渊看起来像刚从值班里被人捞出来，眼下发青，正盯着那堆倒掉的纸杯发呆。\n\n" +
          "你问：“纸杯塔是你碰倒的？”\n\n" +
          "他沉默两秒，很诚实地点头：\n“…是我。”\n\n" +
          "“我当时想抽个杯子接水吃药，劲用大了，整叠一起下来了。然后我想擦一下，结果越擦越滑。”\n\n" +
          "他说完自己先捂脸，声音发闷：\n“你要笑就笑吧，我自己都想笑。”\n\n" +
          "放下手后他又叹了口气，像顺嘴抱怨：\n“我刚把这边拖了一下，转头就看见豆坂将还想去够横幅；再一回头豆雅财在门口挪东西，豆付皮蹲地上抢线。你知道那种感觉吗？像查房时一个病房三个人同时按铃。”\n\n" +
          "他说完又低头看了眼地面，小声补了句：\n“不过这块湿得有点怪，我明明擦过一遍，像又返了一层水光。”\n\n" +
          "他抬眼看了看周围：\n“不过我刚才好像真的有听到奇怪的窸窣动静。”",
        reactions: {
          guilty:
            "豆蛾渊长长叹了口气，像终于能结束口供。\n“行，这个记我头上。”\n\n" +
            "他抬手指了指地面：\n“但先说清楚，这次跟泻药没关系。还有，麻烦顺便让那几个男的别再同时动现场了，我血压有点受不了。”",
          innocent:
            "豆蛾渊抬头看你，眼神都清醒了一点。\n“……我都点头了，你还不往我头上放？”\n\n" +
            "他苦笑一下：\n“也行。反正我今天看起来就像那种会一边收拾一边骂室友的人。”"
        }
      },
  
      {
        id: "doubanjiang",
        name: "豆坂将",
        avatar: "🧭",
        eventTitle: "横幅挂反且快掉下来",
        isCulprit: true,
        questionText:
          "豆坂将正踮脚去够横幅，旁边人死死拦着他不让再碰，场面像在阻止二次灾害。\n\n" +
          "你问：“横幅是你挂的吧？”\n\n" +
          "他理直气壮地点头：\n“是我挂的！但‘挂反’这事得讲视角——我当时站在桌子上，从背面看它是正的！”\n\n" +
          "他又指着绳结，一脸‘你快看我技术’：\n“这个结在野外很好用，快拆、稳。问题是你们这横幅布太滑，墙面又平，受力不对，它就慢慢松了。”\n\n" +
          "他说完自己也看了一眼那条晃晃悠悠的横幅，终于补了句：\n“……行吧，室内确实不该这么挂。\n\n”"+
          "他又低头听了听角落，像顺嘴一提：\n“还有，你们这踢脚线后面是不是有东西在跑？我刚才听见一声。”",
        reactions: {
          guilty:
            "豆坂将叉腰点头，认得很爽快。\n“行，至少你看得出这活是我干的。”\n\n" +
            "他马上又补一句：\n“但你记得写清楚，是技术用错地方，不是我专门来拆台。”",
          innocent:
            "豆坂将一脸震惊。\n“这你都不往我头上放？横幅上现在还挂着我的手艺呢！”\n\n" +
            "他拍了拍你肩膀：\n“你这人要么特别稳，要么特别容易被我唬住。都挺危险的。”"
        }
      },
  
      {
        id: "dounai",
        name: "豆乃",
        avatar: "🎭",
        eventTitle: "门板上扎着飞镖",
        isCulprit: false,
        questionText:
          "豆乃站在门边看飞镖落点，视线在门轴、门把和镖尾之间来回走，像在排一段有点危险的走位。\n\n" +
          "你问：“门上的飞镖是你动的？”\n\n" +
          "她点了下头，又摇头：\n“我动过，不是我先扔的。”\n\n" +
          "她抬手比了比门的开合角度：\n“刚才门再往里开一点，这两支会先刮到人。我就按住门，把角度拨了一下。现在看上去像我摆过。”\n\n" +
          "她顿了顿，朝灯那边看了一眼：\n“我还跟豆莎包说了一句先别追灯效，门口这边先清出来。她回得挺快，至少没在我说完之前再按一次。”\n\n" +
          "她又补得很直：\n“门边地垫打滑，我拿过几个气球配重去压。后面气球上天，可能跟这个也沾点边。”\n\n" +
          "“这种场面里，总有人先做一件很无聊的事——把某个风险点变小。”\n\n" +
          "她抬眼看了眼角落，语气还是平：\n" +
          "“刚才那边窸窣了一声，我不想赌。有人也不想赌。”\n\n" +
          "她看你一眼，语气平平的：\n“你看清楚先后顺序就行。”",
        reactions: {
          guilty:
            "豆乃没跟你争，只是点了点头。\n“行，你这么看也说得过去。”\n\n" +
            "她抬眼看了下门板：\n“就是以后再碰这种场面，未必每个人都还愿意先伸手。”",
          innocent:
            "豆乃轻轻“嗯”了一声，像是认可你在看什么。\n\n" +
            "她把视线转回门边和天花板那片气球：\n“我动过的东西不少，但不是每样都该算在一块儿。豆莎包那边也是。”"
        }
      },
  
      {
        id: "douniwan",
        name: "豆倪万",
        avatar: "🍰",
        eventTitle: "蛋糕不见了",
        isCulprit: false,
        questionText:
          "豆倪万靠在蛋糕桌边那块空位旁，手指有一下没一下地敲着桌沿，像早就等着你来问这一句。\n\n" +
          "你问：“蛋糕去哪了？”\n\n" +
          "她先笑，不急着答：\n“你这起手挺稳啊。东西一没，先来找我。”\n\n" +
          "她低头看了眼桌上的奶油痕和托盘印，指尖在桌边那道反光旁停了一下，又轻轻蹭开：\n“这不是抱走的，是端走的。手挺稳，动作也急，像怕它继续留在这儿会出别的事。”\n\n" +
          "她抬眼看你，笑意浅浅的：\n“你们今晚这屋挺热闹的，小乱子一个接一个，像有人专门爱看这个。”\n\n" +
          "她顿了顿，指尖离开桌沿时像有点不舍：\n“我能说的就这些。再往下说，就没意思了。你自己想。”",
        reactions: {
          guilty:
            "豆倪万笑得更明显了，像刚好看到自己想看的展开。\n“行，省事。你这人做决定挺快的。”\n\n" +
            "她抬手点了点桌面那圈奶油痕：\n“不过下次记得多看两眼痕迹。人会装，桌子一般不演。”",
          innocent:
            "豆倪万看了你两秒，笑意淡了一点，像是认真打量了你一下。\n“可以，至少你不是拿标签在走流程。”\n\n" +
            "她转身前丢下一句：\n“蛋糕还在这屋里。至于谁最想看这屋更乱一点……你之后也许会碰上。”"
        }
      }
    ],
  
    // 复盘先占位（你说暂时不管）
    truthRecap: null,
  
    getRandomIntroLine() {
      const arr = this.introVariants;
      const i = Math.floor(Math.random() * arr.length);
      return arr[i];
    },
  
    evaluateEnding(state) {
      const byId = Object.fromEntries(this.suspects.map(s => [s.id, s]));
      const ids = this.suspects.map(s => s.id);
  
      const judged = (id) => !!state.judgments[id];
      const truth = (id) => !!byId[id].isCulprit;
  
      const allGuilty = ids.every(id => judged(id) === true);
      const allInnocent = ids.every(id => judged(id) === false);
      const allReversed = ids.every(id => judged(id) !== truth(id));
  
      // 伊德海拉预案线：豆池、豆倪万无罪，其余有罪
      const conspiracyPattern =
        judged("douchi") === false &&
        judged("douniwan") === false &&
        ids.filter(id => !["douchi", "douniwan"].includes(id)).every(id => judged(id) === true);
  
      // FFF团：豆雅财、豆莎包、豆付皮、豆知儿有罪，其余无罪
      const fffPattern =
        judged("douyacai") === true &&
        judged("doushabao") === true &&
        judged("doufupi") === true &&
        judged("douzhier") === true &&
        ids.filter(id => !["douyacai", "doushabao", "doufupi", "douzhier"].includes(id)).every(id => judged(id) === false);
  
      // 最佳拍档：豆莎包、豆乃无罪，其余有罪
      const bestPartnerPattern =
        judged("doushabao") === false &&
        judged("dounai") === false &&
        ids.filter(id => !["doushabao", "dounai"].includes(id)).every(id => judged(id) === true);
  
      // 寝室长的噩梦：豆雅财、豆付皮、豆蛾渊、豆坂将有罪，其余无罪
      const dormHeadachePattern =
        judged("douyacai") === true &&
        judged("doufupi") === true &&
        judged("doueyuan") === true &&
        judged("doubanjiang") === true &&
        ids.filter(id => !["douyacai", "doufupi", "doueyuan", "doubanjiang"].includes(id)).every(id => judged(id) === false);
  
      // 隐藏结局：仅豆倪万有罪
      const foxSlipPattern =
        judged("douniwan") === true &&
        ids.filter(id => id !== "douniwan").every(id => judged(id) === false);
      
      const clearEyesPattern =
        judged("doufupi") === true &&
        judged("doubanjiang") === true &&
        judged("dounai") === true &&
        judged("douniwan") === true &&
        ids.filter(id => !["doufupi", "doubanjiang", "dounai", "douniwan"].includes(id)).every(id => judged(id) === false);

      const mouseMentionPattern =
        mouseMentionIds.every(id => judged(id) === false) &&
        ids.filter(id => !["dounai", "douzhier", "doufupi", "doueyuan", "doubanjiang"].includes(id)).every(id => judged(id) === true);
  
      let wrongAccusations = 0;
      let missedCulprits = 0;
      for (const id of ids) {
        if (judged(id) && !truth(id)) wrongAccusations++;
        if (!judged(id) && truth(id)) missedCulprits++;
      }
  
      const unlockRecap = (ending) => ({ ...ending, unlockTruthRecap: true });
      const noRecap = (ending) => ({ ...ending, unlockTruthRecap: false });
  
      // ===== 特殊结局优先 =====
  
      if (foxSlipPattern) {
        return noRecap({
          key: "fox_slip",
          title: "结局：狐狸会漏出马脚",
          text:
            "你最后只把豆倪万放进了名单里。\n\n" +
            "她先是笑，笑得和前面每次一样，像在看你会不会顺着她给的节奏走。可这次你没接她那套，只盯着蛋糕桌边那点反光和冰桶旁的水痕看。\n\n" +
            "“你知道得太刚好了。”你说。\n\n" +
            "她脸上的笑停了不到一秒。就这一秒，已经够明显了。\n\n" +
            "桌边那层薄薄水光里，她的影子边缘像糊开了一点，耳朵和肩线都不太对。她抬手摸了摸脸，露出了标志性的白色耳朵与尾巴，异色的双目中闪烁着狡黠：\n“哎呀，这都能看出来。”\n\n" +
            "豆池反手把符纸拍在桌上，豆付皮已经去拔电源，豆坂将顺手抄起横幅杆，豆蛾渊一边后退一边问：\n“这东西先按什么科收？”\n\n" +
            "你这才知道，混在那张脸底下的不是普通乐子人，而是个更爱看场面失控的东西。它未必亲自动手，但很会推一把。\n\n" +
            "不过派对还是得继续的，毕竟就算是祂也不会毁掉这么完美的一个派对。"
        });
      }
  
      if (fffPattern) {
        return noRecap({
          key: "fff_club",
          title: "结局：FFF团",
          text:
            "你把豆雅财、豆莎包、豆付皮、豆知儿都放进了名单，其余人都放过。\n\n" +
            "现场先安静两秒，然后不知道谁先“哦——”了一声，调查气氛瞬间拐进熟人局八卦频道。\n\n" +
            "豆雅财咳了一声装没听见，豆知儿职业微笑明显卡顿，豆付皮低头捏线，只是讪笑了一声，豆莎包伸手指着自己：“我也算吗？”；\n\n" +
            "你本来是在理现场，结果一不小心把豆家人的CP雷达全点亮了。\n\n" +
            "至于场子？场子还是乱的。\n但现在大家更想先问你：你到底怎么看出来的。"
        });
      }
  
      if (bestPartnerPattern) {
        return noRecap({
          key: "best_partner",
          title: "结局：最佳拍档",
          text:
            "你把豆莎包和豆乃留在名单外，其余人全都记上了。\n\n" +
            "豆莎包和豆乃几乎同时看了你一眼，那一下默契得像提前对过词。\n\n" +
            "一个盯灯光节奏，一个盯门边落点；一个先看画面，一个先看走位。她俩站在一起，莫名有种“这段配合已经做过很多次”的感觉。\n\n" +
            "豆莎包先笑了：“你这人有点意思。”\n豆乃接得很自然：“至少没把所有动过东西的都算成一回事。”\n\n" +
            "后来这天的乱子被反复拿来讲笑话，再后来她俩真拍了部片。首映那天你去看，里头有段乱闪灯和门边飞镖的戏，熟得你差点笑出声。"
        });
      }
  
      if (dormHeadachePattern) {
        return noRecap({
          key: "dorm_headache",
          title: "结局：寝室长的噩梦",
          text:
            "你把豆雅财、豆付皮、豆蛾渊、豆坂将记上了，其余人先放到一边。\n\n" +
            "豆蛾渊听完先沉默，随后缓缓点头，露出一种“我太懂了”的疲惫表情。\n\n" +
            "“一个乱挪东西，一个半夜修设备，一个收尾收成二次灾害，一个在室内硬上野外技巧……”他边数边笑，笑得有点惨，“这不就是我以前当寝室长那会儿的日常吗。”\n\n" +
            "他说着说着精神都回来一点，转头冲所有人来了一句：\n“以后谁再说‘我就动一下’，先举手报备。”\n\n" +
            "你本来只是来理个派对现场，结果顺手把某段学生时代旧账按亮了。\n\n" +
            "场子没立刻变好，但寝室长的PTSD应该要被激发了。"
        });
      }
  
      if (allGuilty) {
        return noRecap({
          key: "label_judge",
          title: "结局：一锅端",
          text:
            "你看了一圈现场，决定把九个人全都记进名单。\n\n" +
            "屋里安静了三秒，然后九个人从九个方向开始开口。有人反驳，有人鼓掌，有人甚至顺手给别人补充两条。\n\n" +
            "场子暂时没收回来，但你成功把派对办成了一场高强度群体申诉会。"
        });
      }
  
      if (allInnocent) {
        return noRecap({
          key: "too_kind",
          title: "结局：都挺不容易",
          text:
            "你沉思片刻，决定谁都不往名单里放。\n\n" +
            "全场先是感动，随后一起沉默——因为气球还在天花板，横幅还在晃，彩灯还在闪，蛋糕还是不见。\n\n" +
            "没人被你误伤，也没人被点出来先收拾。派对最后顺利转型成站着聊天会。"
        });
      }
  
      if (allReversed) {
        return noRecap({
          key: "handler_blame",
          title: "结局：完美错位",
          text:
            "你这轮整理出来的名单，刚好和现场实际情况错得很整齐。\n\n" +
            "该被记上的你都放过去了，不该被记上的一个也没落下。更妙的是，你说得还很笃定，笃定到现场一度开始怀疑是不是他们自己记错了刚才发生的事。\n\n" +
            "最后大家达成了一种罕见平衡：每个人都不服，但谁也说不清该先从哪条开始反驳。"
        });
      }
  
      if (conspiracyPattern) {
        return noRecap({
          key: "conspiracy",
          title: "结局：伊德海拉入侵预案",
          text:
            "你最后把豆池和豆倪万留在名单外，其他人全都记上。\n\n" +
            "这套结果一出来，豆池先是挑了下眉，随后盯着侧桌那圈痕迹看了很久，脸色一点点沉下来。\n\n" +
            "“等下。”她蹲下去，手指悬在那圈晕开的后半段上方，“这不是我写的收尾。”\n\n" +
            "屋里一下安静了。刚才还像熟人局翻车现场的地方，忽然多出一股不该有的潮湿味。桌布那圈痕迹像被水从里面慢慢顶开，冰桶里的融水无风起涟。\n\n" +
            "豆付皮反手拔了音响电源，音响却还是轻轻叫了一声。豆莎包后退半步，豆坂将把横幅杆拎起来，豆蛾渊张口第一句是：\n“这种情况，先叫人还是先跑？”\n\n" +
            "你本来只是来理派对乱子的，结果阴差阳错，提前翻开了《豆家人应对伊德海拉相关异常临时预案》。\n\n" +
            "派对当然没办成。\n但你大概拦住了某个更大的东西先开场。"
        });
      }
      if (clearEyesPattern) {
        return noRecap({
          key: "clear_eyes",
          title: "结局：清澈的眼神",
          text:
            "你最后只把豆付皮、豆坂将、豆乃和豆倪万放进了名单。\n\n" +
            "被你放过的那几位几乎同时松了口气，又立刻开始补解释：像还在上学的人，急着把每一步都讲清楚，讲到你点头为止。\n\n" +
            "而名单里的四个人反倒很安静。有人继续收线，有人继续扶横幅，有人继续盯门口的安全线；还有一个只是笑，笑得太干净，像在看你下一步会怎么走。\n\n" +
            "你忽然意识到，你放走的是一群大学生——眼神还清澈；留下的，是更早学会省力的人。\n\n" +
            "派对照样办起来了，只是你在灯光稳定的那一刻，突然有点想念刚才那阵急着自证的清澈。"
        });
      }

      if (mouseMentionPattern) {
        return noRecap({
          key: "mouse_line",
          title: "结局：不速之客",
          text:
            "你最后把“提过那声窸窣”的人都放过了，其余人全记上。\n\n" +
            "现场先愣了愣，随后有人想反驳，又硬生生把话吞回去——因为那声窸窣偏偏又响了一下，像在提醒：今晚的乱子里确实混进了点“额外因素”。\n\n" +
            "被你放过的几位没再争谁对谁错，只各自把自己那一摊先收住；而被你记上的人看着名单，终于开始老老实实动手干活。\n\n" +
            "派对照样开场。后来大家提起这晚，反而会先问一句：“你听见墙根那声没？”"
        });
      }
      // 完美结局（唯一开放复盘）
      if (wrongAccusations === 0 && missedCulprits === 0) {
        return unlockRecap({
          key: "good_end",
          title: "结局：完美结局",
          text:
            "你把九个人都问完，没有顺着谁的标签走，也没有被现场的热闹带着跑。\n\n" +
            "谁该记上，谁只是刚好站在旁边，谁嘴上绕了点但话里有用，你都慢慢理清了。屋里安静了几秒，居然没人先抬杠——这在豆家人里已经算奇迹。\n\n" +
            "接下来场面突然顺了起来。\n" +
            "豆付皮把音响和灯控重新分线，怪叫没了；豆莎包把灯效调回正常，还顺手留了个真能用的暖场模式；豆坂将在众人监督下把横幅重新挂正；豆雅财踩着凳子去捞天花板上的气球，一边捞一边被笑；豆蛾渊终于把那块地擦到不打滑；豆知儿把样品和礼物彻底分开，顺手把桌面也理齐；豆池补了个正经稳固符，让侧桌布老实待着；豆乃把门边飞镖角度彻底调安全，进出的人都不用再缩脖子。\n\n" +
            "角落里那声被大家当成“错觉”的窸窣，最后也被你们逮了个正着——一只小老鼠从踢脚线后探出头，被豆坂将一根横幅杆轻轻一指，又乖乖缩回去。\n" +
            "豆蛾渊看着它半天，憋出一句：“行，今晚连‘额外嘉宾’都有。”\n\n" +
            "然后最重要的蛋糕也被端了回来——连角都没蹭坏，连那点奶油都像是特意避开了所有“二次事故”和小牙印的可能。\n" +
            "角落里那个差点被所有人忘掉的一个冰桶终于派上了用场，重新加了冰，饮料一放进去，叮叮当当一响，整个派对像是被这声音正式宣布“现在开始”。\n\n" +
            "气球回到了该飘的高度，灯光终于像派对不是像事故片，音乐也正常了。刚才那一屋子的乱子最后全变成了开场前的笑料。\n\n" +
            "这不只是派对办起来了——这场派对后来还挺成功。\n\n" +
            "而你被一致评价为：下次豆家人开派对，记得提前请。"
        });
      }
  
      // 普通结局
      return noRecap({
        key: "mixed",
        title: "结局：勉强开场",
        text:
          "你的结果有些贴边，有些偏了点，但总算把“互相指人”往“边吵边收拾”推进了一步。\n\n" +
          "有人一边吐槽一边补救，有人一边解释一边搬东西，场面在混乱和熟人互损里慢慢回到还能办派对的程度。\n\n" +
          "你抬头看着天花板那片气球，觉得这地方下次最好先买份保险。"
      });
    }
  };
  
  if (typeof window !== "undefined") {
    window.GAME_DATA = GAME_DATA;
  }